name: Create Files in New Repository

on:
  push:
    branches:
      - main

jobs:

  process_data:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        with:
          token: ${{ secrets.PAT_TOKEN }}
        uses: actions/checkout@v3

      - name: Get README.md Contents
        id: get_readme
        run: |
          readme_contents=$(cat README.md)
          echo "readme_contents=$readme_contents" >> $GITHUB_OUTPUT
          
      - name: Get API Response
        id: get_api_response
        run: |
          api_response=$(curl "https://ssyptd4iv1v0gja5.us-east-1.aws.endpoints.huggingface.cloud" \
            -X POST \
            -H "Accept: application/json" \
            -H "Content-Type: application/json" \
            -d '{
              "inputs": "$data",
              "parameters": {
                "top_k": 10,
                "max_new_tokens": 100,
                "do_sample": true,
                "return_full_text": false
              }
            }')
            echo "api_response=$api_response" >> $GITHUB_OUTPUT

          
      - name: Create and Push Files
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'
      - name: Create files
        run: |
          files=$(echo "${{ steps.get_api_response.outputs.api_response }}" | tr ',' '\n')
          total_files=$(echo "$files" | wc -l)
          counter=1
      
          for file in $files; do
            if [ $counter -eq $total_files ]; then
              if [[ $file != *"."* ]]; then
                echo "Ignoring incomplete file name: $file"
                continue
              fi
            fi
      
            if [[ $file == _"/"_ ]]; then
              dir=$(dirname "$file")
              mkdir -p "$dir"
            fi
      
            echo "Creating file: $file"
            echo "Content for $file" > "$file"
      
            counter=$((counter+1))
          done


      - name: Initialize Git and add files
        env:
          TOKEN: ${{ secrets.PAT_TOKEN }}
        run: |
      - name: Commit and push changes
        continue-on-error: true
        run: |
          git config --global user.email "github-actions@example.com"
          git config --global user.name "GitHub Actions"
          git add .
          git commit -m "Automated file creation"
          git push
